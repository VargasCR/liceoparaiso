let dragging=null,schedule={},colorList=["rgba(255, 0, 0, 0.5)","rgba(0, 255, 0, 0.5)","rgba(0, 0, 255, 0.5)","rgba(255, 255, 0, 0.5)","rgba(255, 0, 255, 0.5)","rgba(0, 255, 255, 0.5)","rgba(128, 0, 0, 0.5)","rgba(0, 128, 0, 0.5)","rgba(0, 0, 128, 0.5)","rgba(128, 128, 0, 0.5)","rgba(128, 0, 128, 0.5)","rgba(0, 128, 128, 0.5)","rgba(192, 192, 192, 0.5)","rgba(128, 128, 128, 0.5)","rgba(255, 165, 0, 0.5)","rgba(255, 192, 203, 0.5)","rgba(255, 0, 128, 0.5)","rgba(0, 255, 128, 0.5)","rgba(128, 0, 255, 0.5)","rgba(255, 255, 255, 0.5)","rgba(255, 99, 71, 0.5)","rgba(0, 128, 0, 0.5)","rgba(70, 130, 180, 0.5)","rgba(255, 20, 147, 0.5)","rgba(255, 215, 0, 0.5)","rgba(139, 0, 139, 0.5)","rgba(255, 255, 0, 0.5)","rgba(0, 0, 139, 0.5)","rgba(255, 165, 0, 0.5)","rgba(70, 130, 180, 0.5)"],tagcount=1,profesores={};async function findteacher(){try{const e="http://localhost:3000/api/find-teacher",t=await fetch(e,{method:"GET"}),n=await t.json();profesores=n}catch(e){}}function queryStringToObject(e){const t=new URLSearchParams(e),n={};for(const[e,o]of t)n[e]=o;return n}function findParamAlert(){try{const e=queryStringToObject(window.location.search);if(0!==Object.keys(e).length){switch(e.code){case"1":Swal.fire({icon:"success",title:"Agregado",text:"Se ha agregado correctamente"}).then(e=>{let t=new URL(window.location.href);t.searchParams.delete("code");const n=t.toString();window.location.replace(n)})}}}catch{}}function addTag(){event.preventDefault(),tagcount++;const e=tagcount,t=document.createElement("fieldset");t.id="tag"+e,t.classList.add("fieldset-tag"),t.setAttribute("module",e),t.classList.add("fs-tag");const n=document.createElement("legend");n.textContent="Módulo",t.appendChild(n);const o=document.createElement("label");o.setAttribute("for",""),o.textContent="Nombre",t.appendChild(o);const a=document.createElement("div");a.classList.add("div-tag"),t.appendChild(a);const r=document.createElement("input");r.setAttribute("type","hidden"),r.setAttribute("name","modulo[]"),r.setAttribute("value",e),t.appendChild(r);const l=document.createElement("input");l.type="text",l.classList.add("input-tag"),l.classList.add("name-tag"),l.id="tagn"+e,l.value="",l.placeholder="Nombre del módulo",l.name="tags[]",a.appendChild(l);const c=document.createElement("label");c.setAttribute("for",""),c.textContent="Aula",t.appendChild(c);const d=document.createElement("input");d.type="number",d.classList.add("input-tag"),d.id="tag",d.min="1",d.placeholder="Aula del módulo",d.name="aula[]",t.appendChild(d);const s=document.createElement("button");s.classList.add("btn-tag"),s.textContent="X",s.onclick=function(){deletetag(""+e)},a.appendChild(s);const i=document.createElement("label");i.setAttribute("for",""),i.textContent="Profesores",t.appendChild(i);const u=document.createElement("select");u.name="profesores[]",u.id="profesor",t.appendChild(u);const g=document.createElement("option");g.selected=!0,g.value="-1",g.id="dprofesor",g.textContent="-- Seleccione --",u.appendChild(g);for(let e in profesores)if(profesores.hasOwnProperty(e)){const t=document.createElement("option");t.value=profesores[e].id,t.id="dprofesor",t.textContent=profesores[e].nombre,u.appendChild(t)}const m=document.getElementById("tags");m.appendChild(t),m.style.display="block",m.style.width="100%"}function deletetag(e){event.preventDefault();document.getElementById("tag"+e).remove();for(let t in schedule)if(schedule[t].module===e)document.getElementById(t).setAttribute("ondrop","drop(event)"),delete schedule[t];else if(parseInt(schedule[t])>parseInt(e)){const e=JSON.stringify(schedule);document.querySelector("#schedulejson").value=e}0==document.getElementsByClassName("fieldset-tag").length&&addTag()}function openTab(e,t){let n,o,a;for(e.preventDefault(),o=document.getElementsByClassName("tabcontent"),n=0;n<o.length;n++)o[n].style.display="none";for(a=document.getElementsByClassName("tablinks"),n=0;n<a.length;n++)a[n].className=a[n].className.replace(" active","");const r=document.querySelector("#"+t);r&&(r.style.display="block",e.currentTarget.className+=" active",document.querySelector("#s"+t).classList.add("active")),"tab-schedule"===t&&refreshModelesPanel()}function generarCadenaAleatoria(e){let t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n="";for(let o=0;o<e;o++){let e=Math.floor(Math.random()*t.length);n+=t.charAt(e)}return n}function showDetailSection(e){document.querySelector("#module-list-"+e).classList.toggle("hidden")}function refreshModelesPanel(){const e=document.querySelectorAll(".modules");0!=e.length&&e.forEach((function(e){e.remove()}));const t=document.querySelectorAll(".name-tag"),n=document.querySelectorAll(".fs-tag");for(i=0;i<t.length;i++)""!=t[i].value&&crearModuloPanel("profesores",t,n[i].getAttribute("module"),"",i);i=0;for(const e in schedule){const t=schedule[e].module;var o=document.getElementById(e),a=document.createElement("p");a.draggable=!0,a.setAttribute("module",t),a.ondragstart=drag,a.id=generarCadenaAleatoria(15),a.className="modules",a.textContent=schedule[e].nombre,a.style.backgroundColor=schedule[e].color,a.style.color="black",a.setAttribute("leccion",e),o.appendChild(a),i++}}function allowDrop(e){e.preventDefault()}function drag(e){e.dataTransfer.setData("text",e.target.id),dragging=e.target}function drop(e){e.preventDefault();const t=dragging.getAttribute("leccion");if("profesores"===e.target.id){delete schedule[t],refreshModelesPanel(),document.getElementById(t).setAttribute("ondrop","drop(event)");const e=JSON.stringify(schedule);return void(document.querySelector("#schedulejson").value=e)}const n=dragging.getAttribute("module"),o={module:n,nombre:document.querySelector("#tagn"+n).value,color:colorList[n]};schedule[e.target.id]=o,""!=t&&(document.getElementById(t).setAttribute("ondrop","drop(event)"),delete schedule[t],dragging.remove()),crearModuloCalendario(e.target.id),e.target.setAttribute("ondrop","");const a=JSON.stringify(schedule);document.querySelector("#schedulejson").value=a}function crearModuloCalendario(e){const t=document.getElementById(e),n=document.createElement("p");n.draggable=!0,n.setAttribute("module",schedule[e].module),n.ondragstart=drag,n.id=generarCadenaAleatoria(15),n.className="modules",n.textContent=schedule[e].nombre,n.style.backgroundColor=schedule[e].color,n.style.color="black",n.setAttribute("leccion",e),t.appendChild(n)}function crearModuloPanel(e,t,n,o,a){var r=document.getElementById(e),l=document.createElement("p");l.draggable=!0,l.setAttribute("module",n),l.ondragstart=drag,l.id=generarCadenaAleatoria(15),l.className="modules",l.textContent=t[a].value,l.style.backgroundColor=colorList[n],l.style.color="black",l.setAttribute("leccion",o),r.appendChild(l)}function findclasses(){const e=document.querySelector("#schedulejson").value,t=JSON.parse(e);null!=t&&(schedule=t)}function findTagCount(){const e=document.querySelectorAll(".fs-tag");tagcount=e.length>0?e.length:1}async function eliminarSeccion(e){const t=new FormData;t.append("id",e);try{const e="http://localhost:3000/api/delete-seccion",n=await fetch(e,{method:"POST",body:t});return await n.json()}catch(e){}}async function showconfirmremoveSeccion(e){if((await Swal.fire({title:"¿Seguro que desea eliminar?",text:"No se podrá revertir ningún item relacionado",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",cancelButtonText:"CANCELAR",confirmButtonText:"Sí, borrarlo"})).isConfirmed){const t=await eliminarSeccion(e);"estudiante"==t?Swal.fire("Error","La sección está asignada a estudiantes","error"):!0===t&&Swal.fire({icon:"success",title:"Completado",text:"Se ha agregado eliminado correctamente"}).then(e=>{location.reload()})}}