const video=document.getElementById("video-preview"),canvas=document.getElementById("photo-canvas"),ctx=canvas.getContext("2d");navigator.mediaDevices.getUserMedia({video:!0}).then((function(t){video.srcObject=t,video.play(),requestAnimationFrame(tick)}));let scanning=!0;async function tick(){if(scanning){if(video.readyState===video.HAVE_ENOUGH_DATA){canvas.width=video.videoWidth,canvas.height=video.videoHeight,ctx.drawImage(video,0,0,canvas.width,canvas.height);const t=ctx.getImageData(0,0,canvas.width,canvas.height),e=jsQR(t.data,t.width,t.height);if(e&&e.data){scanning=!1;const t=await agregarAsistencia_beca(e.data);"repetido"==t?Swal.fire({position:"center",icon:"error",title:"Estudiante ya agregado",showConfirmButton:!1,timer:3e3}).then(t=>{starttick()}):"nobeca"==t?Swal.fire({position:"center",icon:"error",title:"Estudiante no becado",showConfirmButton:!1,timer:3e3}).then(t=>{starttick()}):Swal.fire({position:"center",icon:"success",title:"AGREGADO",showConfirmButton:!1,timer:3e3}).then(t=>{starttick()})}}requestAnimationFrame(tick)}}async function agregarDesdeDNI(t){const e=await agregarAsistencia_beca(t);"repetido"==e?Swal.fire({position:"center",icon:"error",title:"Estudiante ya agregado",showConfirmButton:!1,timer:3e3}).then(t=>{starttick()}):"nobeca"==e?Swal.fire({position:"center",icon:"error",title:"Estudiante no becado",showConfirmButton:!1,timer:3e3}).then(t=>{starttick()}):Swal.fire({position:"center",icon:"success",title:"AGREGADO",showConfirmButton:!1,timer:3e3}).then(t=>{starttick()})}function starttick(){setTimeout((function(){scanning=!0,tick()}),3e3)}async function agregarAsistencia_beca(t){const e=new FormData;e.append("id",t);try{const t="/api/add-attendance-qr",i=await fetch(t,{method:"POST",body:e}),n=await i.json();return"repetido"===n||"nobeca"===n?n:!!n.resultado}catch(t){return!1}return!1}