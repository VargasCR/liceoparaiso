let estudiantes=[];function addListenerSearch(){const e=document.querySelector("#search-input");e.value=localStorage.getItem("search"),e.addEventListener("input",(function(n){const o=e.value;localStorage.setItem("search",o);const a=t.value;localStorage.setItem("searchseccion",a),encontrarEstudiantes()}));const t=document.querySelector("#search-select");t.value=localStorage.getItem("searchseccion"),""==t.value&&(t.value="0"),t.addEventListener("change",(function(n){const o=t.value;localStorage.setItem("searchseccion",o);const a=e.value;localStorage.setItem("search",a),encontrarEstudiantes()}))}async function showSearchBar(){const e=document.querySelector("#search-input");e.classList.toggle("hidden");document.querySelector("#search-select").classList.toggle("hidden");const t=new FormData;e.classList.contains("hidden")?t.append("value",0):t.append("value",1);try{const e="http://localhost:3000/api/set-searching-bar",n=await fetch(e,{method:"POST",body:t});await n.json()}catch(e){}}function queryStringToObject(e){const t=new URLSearchParams(e),n={};for(const[e,o]of t)n[e]=o;return n}function findParamAlert(){try{const e=queryStringToObject(window.location.search);if(0!==Object.keys(e).length){switch(e.code){case"1":Swal.fire({icon:"success",title:"Agregado",text:"Se ha agregado correctamente"}).then(e=>{let t=new URL(window.location.href);t.searchParams.delete("code");const n=t.toString();window.location.replace(n)})}}}catch{}}async function encontrarEstudiantes(){const e=new FormData;e.append("search",localStorage.getItem("search")),e.append("searchseccion",localStorage.getItem("searchseccion"));try{const t="http://localhost:3000/api/find-student",n=await fetch(t,{method:"POST",body:e}),o=await n.json();estudiantes=o,localStorage.setItem("grupos",JSON.stringify(o.grupos)),clean_estudiantes(),mostrarEstudiantes(),findStudentSelected()}catch(e){console.log(e)}}function open_student(e){document.querySelector("#private-student-info-"+e).classList.toggle("hidden")}function addListenerTransport(){document.querySelector("#transporte").addEventListener("change",(function(){document.querySelector("#divtransporte").classList.toggle("hidden")}))}function printID(){let e={};try{e=JSON.parse(localStorage.getItem("selectedStudents"))}catch(e){}Swal.fire({title:"¿Qué desea imprimir?",icon:"question",showCancelButton:!0,confirmButtonText:"Lista",cancelButtonText:"Carné",cancelButtonColor:"#716add",showCloseButton:!0,closeButtonText:"Cancel"}).then(t=>{t.isConfirmed?Swal.fire({title:"¿Qué lista desea imprimir?",icon:"question",showCancelButton:!0,confirmButtonText:"Seleccionado",cancelButtonText:"Todos",cancelButtonColor:"#716add",showCloseButton:!0,closeButtonText:"Cancel"}).then(t=>{if(t.isConfirmed){if(null!=e)return void(0!=e.length?Swal.fire("Imprimiendo seleccionados","","success"):Swal.fire({position:"center",icon:"error",title:"Lista vacía",showConfirmButton:!1,timer:1500}).then(e=>{}));Swal.fire({position:"center",icon:"error",title:"Lista vacía",showConfirmButton:!1,timer:1500}).then(e=>{})}else t.dismiss===Swal.DismissReason.cancel?Swal.fire("Imprimiendo todos","","success"):Swal.fire("Cancelado","Acción cancelada","error")}):t.dismiss===Swal.DismissReason.cancel?Swal.fire({title:"¿Qué carné desea imprimir?",icon:"question",showCancelButton:!0,confirmButtonText:"Seleccionado",cancelButtonText:"Todos",cancelButtonColor:"#716add",showCloseButton:!0,closeButtonText:"Cancel"}).then(t=>{if(t.isConfirmed){if(null!=e)return void(0!=e.length?Swal.fire("Imprimiendo seleccionados","","success"):Swal.fire({position:"center",icon:"error",title:"Lista vacía",showConfirmButton:!1,timer:1500}).then(e=>{}));Swal.fire({position:"center",icon:"error",title:"Lista vacía",showConfirmButton:!1,timer:1500}).then(e=>{})}else t.dismiss===Swal.DismissReason.cancel?Swal.fire("Imprimiendo seleccionados","","success"):Swal.fire("Cancelado","Acción cancelada","error")}):Swal.fire("Cancelado","Acción cancelada","error")})}function downloadID(){let e={};try{e=JSON.parse(localStorage.getItem("selectedStudents"))}catch(e){}Swal.fire({title:"¿Qué desea descargar?",icon:"question",showCancelButton:!0,confirmButtonText:"Lista",cancelButtonText:"Carné",cancelButtonColor:"#716add",showCloseButton:!0,closeButtonText:"Cancel"}).then(t=>{t.isConfirmed?Swal.fire({title:"¿Cual lista desea descargar?",icon:"question",showCancelButton:!0,confirmButtonText:"Seleccionado",cancelButtonText:"Todos",cancelButtonColor:"#716add",showCloseButton:!0,closeButtonText:"Cancel"}).then(t=>{if(t.isConfirmed){if(null!=e)return void(0!=e.length?(crearReporte(0,0,0),Swal.fire("Descargando seleccionados","","success")):Swal.fire({position:"center",icon:"error",title:"Lista vacía",showConfirmButton:!1,timer:1500}).then(e=>{}));Swal.fire({position:"center",icon:"error",title:"Lista vacía",showConfirmButton:!1,timer:1500}).then(e=>{})}else t.dismiss===Swal.DismissReason.cancel?(crearReporte(0,0,1),Swal.fire("Descargando todos...","","success")):Swal.fire("Cancelado","Acción cancelada","error")}):t.dismiss===Swal.DismissReason.cancel?Swal.fire({title:"¿Cuales carné desea descargar?",icon:"question",showCancelButton:!0,confirmButtonText:"Seleccionado",cancelButtonText:"Todos",cancelButtonColor:"#716add",showCloseButton:!0,closeButtonText:"Cancel"}).then(t=>{if(t.isConfirmed){if(t.isConfirmed){if(null!=e)return void(0!=e.length?crearReporte(0,1,0):Swal.fire({position:"center",icon:"error",title:"Lista vacía",showConfirmButton:!1,timer:1500}).then(e=>{}));Swal.fire({position:"center",icon:"error",title:"Lista vacía",showConfirmButton:!1,timer:1500}).then(e=>{})}}else t.dismiss===Swal.DismissReason.cancel?crearReporte(0,1,1):Swal.fire("Cancelado","Acción cancelada","error")}):Swal.fire("Cancelado","Acción cancelada","error")})}function mostrarEstudiantes(e=0){var t={};if(1==e)t=estudiantes.grupos;else t=JSON.parse(localStorage.getItem("grupos"));const n=document.querySelector("#item-container");let o="";estudiantes.informacion.forEach(n=>{let a="";var c=t.filter((function(e){return e.id==n.seccion}));a=c[0].grado+" - "+c[0].seccion;const i=n.transporte;let s="reprobado",r="reprobado";s=1==n.comedor?"Aprobado":"reprobado",r=1==i?"Aprobado":"reprobado";const l=e;o+=`\n      <div class="public-student-container">\n      <div class="public-student" onclick="open_student(${n.id})">\n      <input type="checkbox" id="cb-${n.id}" class="cbSelect" onclick="addStudentSelected(${n.id},${l}); event.stopPropagation()"></input>\n      <div class="public-student-image-container">\n            <img src="/build/img/pictures/${n.id}.jpg" alt="">\n          </div>\n          <div class="public-student-info">\n            <h4>${n.nombre} ${n.apellido}</h4>\n            <p>Cédula: ${n.dni}</p>\n            <p>Sección: ${a}</p>\n            <div id="private-student-info-${n.id}" class="hidden">\n              <p>Comedor: ${s}</p>\n              <p>Transporte: ${r}</p>`,1==n.transporte&&(o+=`\n                  <p>Ruta: ${n.ruta}</p>\n                  <p>Asiento: ${n.asiento}</p>\n                \n                `),o+="\n            </div>",1!=e&&(o+=`\n            <div class="btn-edit-student">\n              <a class="btn-student btn-edit" href="/dashboard-student-edit?id=${n.id}">\n                <img src="/build/img/edit-student.svg" class="btn-student-ico" alt="Icono">\n              </a>\n              <button class="btn-student btn-delete" onclick="showconfirmremoveStudent(${n.id}); event.stopPropagation()">\n                <img src="/build/img/delete-student.svg" class="btn-student-ico" alt="Icono">\n              </button>\n            </div>`),o+="\n          </div>\n        </div>\n      </div>\n      "}),n.innerHTML=o}function showconfirmremoveStudent(e){Swal.fire({title:"¿Eliminar estudiante?",text:"Una vez eliminado, no se podrá restaurar",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",cancelButtonText:"Cancelar",confirmButtonText:"Sí, borrar"}).then(t=>{if(t.isConfirmed){eliminarEstudiante(e).then((function(e){!0===e?Swal.fire("Eliminado","Se ha eliminado con exito","success").then(e=>{clean_estudiantes(),encontrarEstudiantes()}):Swal.fire("Error","Algo ha ocurrido, intentelo nuevamente","error")})).catch((function(e){console.error(e)}))}})}async function eliminarEstudiante(e){const t=new FormData;t.append("id",e);try{const e="http://localhost:3000/api/delete-student",n=await fetch(e,{method:"POST",body:t});return await n.json()}catch(e){console.log(e)}}async function clean_estudiantes(){for(var e=document.querySelector("#item-container");e.firstChild;)e.removeChild(e.firstChild)}function findStudentSelected(e=0){try{let t=JSON.parse(localStorage.getItem("selectedStudents"));0==e&&(t.length>0?(document.querySelector("#btn-list").classList.remove("hidden"),document.querySelector("#btn-check").classList.remove("hidden"),document.querySelector("#selecting").checked=!0):(document.querySelector("#btn-list").classList.add("hidden"),document.querySelector("#btn-check").classList.add("hidden"),document.querySelector("#selecting").checked=!1)),null!==t&&t.forEach(e=>{try{document.getElementById("cb-"+e).checked=!0}catch(e){}})}catch(e){}}function unselectAll(e=0){try{null!==JSON.parse(localStorage.getItem("selectedStudents"))?(localStorage.removeItem("selectedStudents"),0==e?encontrarEstudiantes():(clean_estudiantes(),document.querySelector("#selecting").classList.add("hidden"),Swal.fire({position:"center",icon:"success",title:"Lista vacía",showConfirmButton:!1,timer:1500}).then(e=>{window.location.href="/dashboard-student"}))):estudiantes.informacion.forEach(e=>{addStudentSelected(String(e.id),0),encontrarEstudiantes()});try{document.querySelector("#btn-list").classList.add("hidden"),document.querySelector("#btn-check").classList.add("hidden")}catch(e){}}catch(e){}}function addStudentSelected(e,t=0){let n=JSON.parse(localStorage.getItem("selectedStudents"));const o=e.toString();if(null===n)n=[],n.push(o);else{const e=n.indexOf(o);e>-1?n.splice(e,1):n.push(o)}if(0==t){if(!(n.length>0))return document.querySelector("#btn-list").classList.add("hidden"),document.querySelector("#btn-check").classList.add("hidden"),document.querySelector("#selecting").checked=!1,localStorage.removeItem("selectedStudents"),void(n=null);document.querySelector("#btn-list").classList.remove("hidden"),document.querySelector("#btn-check").classList.remove("hidden"),document.querySelector("#selecting").checked=!0}else{if(0!=n.length)return localStorage.setItem("selectedStudents",JSON.stringify(n)),void showSelectedStudent();clean_estudiantes(),Swal.fire({position:"center",icon:"success",title:"Lista vacía",showConfirmButton:!1,timer:1500}).then(e=>{localStorage.setItem("selectedStudents",JSON.stringify(n)),window.location.href="/dashboard-student"})}localStorage.setItem("selectedStudents",JSON.stringify(n))}async function showSelectedStudent(){let e=JSON.parse(localStorage.getItem("selectedStudents"));if(e.length>0){const t=e.join(","),n=new FormData;n.append("id",t);try{const e="http://localhost:3000/api/find-student-selected",t=await fetch(e,{method:"POST",body:n}),o=await t.json();estudiantes=o,localStorage.setItem("grupos",JSON.stringify(o.grupos)),clean_estudiantes(),mostrarEstudiantes(1),findStudentSelected(1)}catch(e){}}}async function deleteSelectedList(e=0){if(0==e){let e=JSON.parse(localStorage.getItem("selectedStudents"));if(e.length>0){const t=e.join(","),n=new FormData;n.append("id",t);try{const e="http://localhost:3000/api/delete-student-selected",t=await fetch(e,{method:"POST",body:n});await t.json()?(localStorage.removeItem("selectedStudents"),window.location.href="/dashboard-student"):Swal.fire("Error","Algo ha ocurrido, intentelo nuevamente","error")}catch(e){}}else Swal.fire({position:"center",icon:"error",title:"Lista vacía",showConfirmButton:!1,timer:1500})}else{const e=new FormData;try{const t="http://localhost:3000/api/delete-student-all",n=await fetch(t,{method:"POST",body:e});await n.json()?(localStorage.removeItem("selectedStudents"),window.location.href="/dashboard-student"):Swal.fire("Error","Algo ha ocurrido, intentelo nuevamente","error")}catch(e){}}}function askdeleteSelectedList(){Swal.fire({title:"¿Qué desea eliminar?",icon:"question",showCancelButton:!0,confirmButtonText:"Seleccionado",cancelButtonText:"Todos",cancelButtonColor:"#716add",showCloseButton:!0,closeButtonText:"Cancel"}).then(e=>{if(e.isConfirmed){let e={};try{e=JSON.parse(localStorage.getItem("selectedStudents"))}catch(t){e={}}null!=e?Swal.fire("Eliminando seleccionados...","","success").then(e=>{deleteSelectedList(0)}):Swal.fire({position:"center",icon:"error",title:"Lista vacía",showConfirmButton:!1,timer:1500})}else e.dismiss===Swal.DismissReason.cancel?Swal.fire("Eliminando todos...","","success").then(e=>{deleteSelectedList(1)}):Swal.fire("Cancelado","Acción cancelada","error")})}async function crearReporte(e,t,n){switch(e){case 0:switch(t){case 0:switch(n){case 0:let e=JSON.parse(localStorage.getItem("selectedStudents"));if(null!==e){const t=e.join(","),n=new FormData;n.append("id",t);try{const e="http://localhost:3000/api/download-list-selected",t=await fetch(e,{method:"POST",body:n}),o=await t.json();o?window.open(o,"_blank"):Swal.fire("Error","Algo ha ocurrido, intentelo nuevamente","error")}catch(e){}}break;case 1:const t=new FormData;t.append("id","all");try{const e="http://localhost:3000/api/download-list-all",n=await fetch(e,{method:"POST",body:t}),o=await n.json();o?(window.open(o,"_blank"),Swal.fire("Descargando...","","success")):Swal.fire("Error","Algo ha ocurrido, intentelo nuevamente","error")}catch(e){}}break;case 1:switch(n){case 0:let e=JSON.parse(localStorage.getItem("selectedStudents"));if(null!==e){const t=e.join(","),n=new FormData;n.append("id",t);try{const e="http://localhost:3000/api/download-carnet-selected",t=await fetch(e,{method:"POST",body:n}),o=await t.json();window.open(o,"_blank"),o||Swal.fire("Error","Algo ha ocurrido, intentelo nuevamente","error")}catch(e){}}break;case 1:const t=new FormData;t.append("id","all");try{const e="http://localhost:3000/api/download-carnet-all",n=await fetch(e,{method:"POST",body:t}),o=await n.json();window.open(o,"_blank"),o?Swal.fire("Descargando...","","success"):Swal.fire("Error","Algo ha ocurrido, intentelo nuevamente","error")}catch(e){}}}}}async function registrarAsistencia_becaSeleccion(){let e=JSON.parse(localStorage.getItem("selectedStudents"));if(e.length>0){const t=e.join(","),n=new FormData;n.append("id",t);try{const e="http://localhost:3000/api/add-attendance",t=await fetch(e,{method:"POST",body:n}),o=await t.json();let a="";for(let e in o)o.hasOwnProperty(e)&&(a+="- ",a+=o[e],a+="<br>");o?Swal.fire({title:"Agregar a lista diaria de beca?",text:"",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",cancelButtonText:"Cancelar",confirmButtonText:"Sí, agregar"}).then(e=>{e.isConfirmed?Swal.fire({icon:"success",title:"Reporte",html:a}):Swal.fire("Cancelado","Acción cancelada","error")}):Swal.fire("Error","Algo ha ocurrido, intentelo nuevamente","error")}catch(e){}}else Swal.fire({position:"center",icon:"error",title:"Lista vacía",showConfirmButton:!1,timer:1500})}